{% extends 'main.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-6 style">
        <div class="jumbotron">
            <h4 style="text-align:center">Forgot Password</h4>
            <p>&nbsp;</p>
                <div class="form-group">
                    <label for="password">Old Password</label>
                    <input type="password" id="old-password" name="password" class="form-control" placeholder="Enter Password" />
                </div>
                <div class="form-group">
                    <label for="password">New Password</label>
                    <input type="password" id="new-password" name="password" class="form-control" placeholder="Enter Password" />
                </div>
                <div class="form-group">
                    <label for="password">Confirm Password</label>
                    <input type="password" id="new-password-2" name="confirm_password" class="form-control" placeholder="Confirm Password" />
                </div>
            <form>
                {% csrf_token %}
                <div class="form-group">
                    <button class="btn btn-primary" id="change-password">Change Password</button>
                </div>
            </form>
            <div class="error-message-bottom-all">
                <span class="text-span" id="change-success" style="color:green"></span>
                <span class="text-span" id="change-error" style="color:red"></span>
            </div>
        </div>
    </div>
</div>
{% block javascript %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock javascript %}
<script>
$("#change-password").unbind().click(function (e){
      e.preventDefault();
      $('#change-success').empty();
      $('#change-error').empty();
      $(".error-group").removeClass("error-group");
      var csrf_token = $("[name='csrfmiddlewaretoken']").val();
      var old_password = $("#old-password").val();
      var password = $("#new-password").val();
      var confirm_password = $("#new-password-2").val();
      var flag = 0;
      if (old_password == "") {
        $("#old-password").parent().parent().addClass("error-group");
        flag = 1;
      }
      if (password == "") {
        $("#new-password").parent().parent().addClass("error-group");
        flag = 1;
      }
      if (confirm_password == "") {
        $("#new-password-2").parent().parent().addClass("error-group");
        flag = 1;
      }
      if (password != confirm_password) {
        $("#confirm_password").parent().parent().addClass("error-group");
        $("#change-error").text("Passwords do not match");
        return;
      }
      if (flag == 1) {
        $("#change-error").text("Please fill all required fields.");
        return;
      }
      else {
        $.ajax({
          url: "{% url 'reg_website:change_password' %}",
          type: "POST",
          data: {
            csrfmiddlewaretoken: csrf_token,
            old_password: old_password,
            new_password: password,
          },
          success: function (response) {
            if (response["status"] == true) {
              $("#change-success").text(response["message"]);
              $("#change-success").css("color", "green");
              setTimeout("location.reload(true)", 10000);
              window.location = "{% url 'reg_website:email_login' %}";
              return true;
            }
            $("#change-error").text(response["message"]);
            $("#change-error").css("color", "red");
            return false;
          },
          error: function (err)
          {
            $("#change-error").text(err);
          },
        });
      }
   });
</script>

{% endblock %}