{% extends 'main.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-6 style">
        <div class="jumbotron">
            <h4 style="text-align:center">Resend Email</h4>
            <p>&nbsp;</p>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="resend-email" name="email" class="form-control" placeholder="Enter email address" />
            </div>
            <form>
                {% csrf_token %}
                <div class="form-group">
                    <button class="btn btn-primary btn-lg form-control" id="send-email">Send Email</button>
                </div>
                <div class="error-message-bottom-all">
                    <span class="text-span" id="email-send-success" style="color:green"></span>
                    <span class="text-span" id="email-send-error" style="color:red"></span>
                </div>
            </form>
        </div>
    </div>
</div>
{% block javascript %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock javascript %}
<script>
function isValidEmailAddress(emailAddress)
  {
    var pattern = new RegExp(
      /^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i
    );
    return pattern.test(emailAddress);
  }
$("#send-email").unbind().click(function (e){
      e.preventDefault();
      $('#email-send-success').empty();
      $('#email-send-error').empty();
      $(".error-group").removeClass("error-group");
      var csrf_token = $("[name='csrfmiddlewaretoken']").val();
      var email = $("#resend-email").val();
      var flag = 0;
      if (email == "") {
        $("#resend-email").parent().parent().addClass("error-group");
        flag = 1;
      }
      if (isValidEmailAddress(email) == false && email != "") {
        $("#email").parent().parent().addClass("error-group");
        $("#email-send-error").text("Enter valid email address.");
        return;
      }
      if (flag == 1) {
        $("#email-send-error").text("Please fill all required fields.");
        return;
      }
      else {
        $.ajax({
          url: "{% url 'reg_website:resend_email'%}",
          type: "POST",
          data: {
            csrfmiddlewaretoken: csrf_token,
            email: email,
          },
          success: function (response) {
            if (response["status"] == true) {
              $("#email-send-success").text(response["message"]);
              return;
            }
            $("#email-send-error").text(response["message"]);
            return false;
          },
          error: function (err)
          {
            $("#email-send-error").text(err);
          },
        });
      }
   });
</script>

{% endblock %}